# 들어가며
동기화는 비단 프로세스만이 대상이 아니라 스레드도 대상이 된다. 동기화는 스레드도 포함되는 개념이라는 것을 꼭 기억하자. 이 글에서 '프로세스와 스레드'가 아닌 프로세스라고 언급되어도 둘 모두가 해당된다고 생각하고 읽어주면 된다.

어쨌든 동시다발적으로 실행되는 프로세스들과 스레드들은 서로 협력하면서 영향을 주고받게 되는데, 이 과정에서 '자원의 일관성'을 보장해야 한다.

# 동기화의 의미
- 각기 다른 프로세스들은 공동의 목적을 이루기 위해 동시다발적으로 서로 협력하면서 수행될 수가 있다. 
  - e.g) 워드 프로세서 프로그램
    - 맞춤법 검사 프로세스
    - 입력 내용을 화면에 출력하는 프로세스
    - ...
  - 그렇게 동시다발적으로 실행되는 프로세스들은 올바른 수행을 위해 **동기화**되어야 한다.


- 동기화란?
  - 프로세스들의 수행 시기를 맞추는 것
  - **실행 순서 제어**: 프로세스를 올바른 순서대로 실행하기
  - **상호 배제**: 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기

## 실행 순서 제어를 위한 동기화: reader writer problem
- Writer: Book.txt 파일에 값을 **저장하는** 프로세스
- Reader: Book.txt 파일에 저장된 값을 **읽어들이는** 프로세스
  - "Book.txt 안에 값이 존재한다."는 특정 조건이 만족해야만 실행 가능
- Reader, Writer 프로세스는 무작정 아무렇게나 실행되어서는 안 된다. 실행의 순서가 있기 때문.
- "동시다발적으로 실행되는 두 개 이상의 프로세스들의 실행 순서를 제어하기 위해 동기화를 하는 것이 실행 순서 제어를 위한 동기화다."

## 상호 배제를 위한 동기화: Bank account problem
- **공유가 불가능한 자원**의 동시 사용을 피하기 위한 동기화
  - 한 번에 하나의 프로세스만 이용해야 하는 자원이 있을 때, 한 번에 하나의 프로세스만 이용하도록 만드는 동기화
- e.g) 현재 계좌에 잔액 10만원
  - 프로세스 A는 현재 잔액에 2만원을 추가하는 프로세스
  - 프로세스 B는 현재 잔액에 5만원을 추가하는 프로세스
  - 동기화가 이루어지지 않으면 잔액은 17만원이 아닌 12만원 혹은 15만원이 될 수 있음
    - 더한 값을 저장하기 전에 문맥 교환이 일어난다면 그렇게 됨

## 상호 배제를 위한 동기화: Producer & Consumer problem (유명, 중요)
- 물건을 계속해서 생산하는 생산자(producer, 프로세스 혹은 스레드)
- 물건을 계속해서 소비하는 소비자(consumer, 프로세스 혹은 스레드)
- '총합'이라는 변수 공유
- 생산자를 100,000번 / 소비자를 100,000번 실행하면 '**총합**'은?
  - 동기화를 하지 않았기에 0이 아니라 63000이 될 수도, -10000이 될 수도 있음

```
총합 = 0

생산자() {
    버퍼에 데이터 삽입
    '총합' 변수 1증가
}

소비자() {
    버퍼에서 데이터 빼내기
    '총합' 변수 1감소
}
```

## 공유 자원과 임계 구역
- **공유 자원**: 여러 프로세스 혹은 스레드가 공유하는 자원
  - e.g) 전역 변수, 파일, 입출력 장치, 보조기억장치, ...
- **임계 구역**: 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역
  - 앞선 예시의 '총합' 변수, '잔액' 변수, ...
  - 임계 구역에 동시에 접근하면 자원의 일관성이 깨질 수 있다. 이를 **레이스 컨디션**이라고 한다.


## 운영체제가 임계 구역 문제를 해결하는 세 가지 원칙
- 상호 배제를 위한 동기화를 위한 세 가지 원칙
  1. 상호 배제 (mutual exclusion): 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 들어올 수 없다.
  2. 진행 (progress): 임계 구역에 어떤 프로세스라도 진입하지 않았다면 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
  3. 유한 대기 (bounded waiting): 한 프로세스가 임계 구역에 진입하고 싶다면 언젠가는 임계 구역에 들어갈 수 있어야 한다(= 임계 구역에 들어가기 위해 무한정 대기해서는 안 된다).