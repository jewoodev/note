도커는 '컨테이너라는 경량 단위로 애플리케이션을 실행하는 기능'을 제공하는 플랫폼이다. 그리고 컨테이너는 '클라우드의 서비리스 함수'부터 '기업의 전략 수립'까지, 소프트웨어 분야의 거의 모든 곳에 자리 잡았다.  

컨테이너가 무엇에 쓰는 것인지 한 번 알아보자. 알아보기 위해 도커를 도입해 큰 성과를 거두고 있는 다섯 가지의 주요 시나리오를 설명할 것이다. 그리고 컨테이너로 해결할 수 있는 다양한 문제도 소개할 것이다. 

# 컨테이너가 IT 세상을 점령한 이유
2014년, 나는 안드로이드 단말기를 위한 API를 만드는 프로젝트에 참여하며 도커를 처음 접했다. 접한 이후 계속 도커를 활용하며 자신감이 붙게 되었고, 테스트 환경을 컨테이너에서 동작하는 API로 구성하게 됐다. 이 프로젝트가 마무리될 무렵엔 비교적 높은 기준의 가용성과 확장성을 필요로 했던 운영 환경까지 모든 환경이 도커로 동작하는 단계에 들어섰었다.

그 정도 크기의 프로젝트였지만 내가 프로젝트에서 하차할 때 새 개발 팀에 전달했던 인수인계 자료는 깃허브 저장소에 포함된 README 파일 뿐이었다. 운영 환경과 테스트 환경을 막론하고 애플리케이션을 빌드하고, 배포하고, 관리하는 모든 업무가 도커를 통해 이뤄지고 있었다. 새로 합류하는 개발자는 소스 코드를 내려받고 나면 명령어 한 줄로 로컬 머신에서 빌드와 실행을 끝낼 수 있었다. 운영 팀 역시 운영 환경 클러스터에서 실행 중인 컨테이너를 관리하고 배포하는 데에 동일한 도구를 사용했다.

원래 이 정도 규모의 프로젝트를 인수인계하려면 대개 2주 정도 걸린다. 새 개발 팀은 대여섯 가지나 되는 도구를 특정한 버전으로 설치해야 하고 운영 팀도 또 다른 도구 대여섯 가지를 설치해야 하는 경우가 다반사이다. 그러나 도커를 도입하고 나니 모든 툴체인이 중앙집중화되어 어떤 역할의 조직에서도 모든 작업이 간단해졌다. 

## 클라우드 환경으로 이주하기
클라우드 기술이 발전되고 나서부터 기업들의 최우선 관심사는 기존 애플리케이션의 클라우드로의 이전에 있을 것이다. 서버, 스토리지, 네트워크, 그리고 심지어 전원까지 클라우드 업체에 맡겨버릴 수 있다니 매력적이지 않을 수가 없다. 전 세계에 존재하는 글로벌 데이터 센터에 애플리케이션을 입주시켜 사실상 무제한의 확장성을 누릴 수 있고, 눈 깜짝할 사이에 새로운 환경에 애플리케이션을 배포할 수도 있고, 비용도 실제 사용한 만큼만 부담하면 된다. 이런 매력적인 클라우드 환경으로 마이그레이션하려면 어떻게 해야 할까?

기존에는 클라우드 환경으로 이전하려면 IaaS와 Paas 두 가지 선택지가 있었다. 각 선택지는 일장일단이 있다. PaaS는 애플리케이션의 각 컴포넌트를 하나씩 클라우드의 매니지드 서비스로 옮기는 까다로운 프로젝트를 진행해야 한다. 이는 애플리케이션이 특정 클라우드에 종속되게 한다. 하지만 적어도  운영비는 절감할 수 있다. Iaas는 애플리케이션의 각 컴포넌트를 가상머신에서 동작시키게 한다. 특정 클라우드에 종속되는 것은 피할 수 있지만 운영 비용이 상승힌다. 도커는 앞에서 언급되었던 단점들이 없는 또 다른 선택지를 제공한다. 도커를 도입하면 애플리케이션의 각 컴포넌트를 컨테이너로 이주한 다음 클라우드의 컨테이너 서비스들로 실행하거나 직접 구축한 도커 클러스터에서 전체 애플리케이션을 실행할 수 있다. 

컨테이너로 이주하기 위해 어느 정도 비용이 필요하다. 원 기존 설치 절차를 Dockerfile이라는 스크리ㅂ트로 재작성해야 하고, 배포 관련 사항 역시 도커 컴포즈나 쿠버네티스에서 사용되는 애플리케이션 매니페스트로 재작성해야 한다. 코드를 수정할 필요는 없다. 

## 레커시 애플리케이션 현대화하기
기존 애플리케이션의 구조가 낡은 모놀리식 설계로 방치되어 있다면 이는 도커 혹은 클라우드 플랫폼의 진가를 발휘하기 어려운 구조가 될 것이다. 그러한 애플리케이션이더라도 컨테이너에서 동작하는 데에는 문제가 없겠지만 기민성에 제약이 따른다. 잘 관리되어진 컨테이너 환경에서는 30초면 새 기능을 단계적으로 자동 배포할 수 있지만, 이 새 기능이 모놀리식 설계를 가진 200만 줄 코드의 일부분이라면 이야기가 조금 달라진다. 

애플리케이션의 낡은 설계는 도커로 마이그레이션하는 것만으로도 탈바꿈될 수 있다. 애플리케이션을 전면적으로 재구현하지 않고도 새로운 패턴을 도입할 수 있다. 방법까지 간단하다. Dockerfile 스크립트와 도커 컴포즈 문법을 따라 애플리케이션을 단일 컨테이너로 옮긴다. 그 과정만하더라도 통짜 애플리케이션의 컨테이너 마이그레이션이 끝난다. 

컨테이너는 가상 네트워크를 통해 외부에 노출되지 않고 서로 통신하는 것이 가능하다. 그렇기에 통짜 애플리케이션을 분할해 기능별로 다른 컨테이너에 배치하는 것이 가능하다. 결과적으로 애플리케이션이 여러 개의 컨테이너로 분할된 분산 애플리케이션이 되어 간다. 

분할된 분산 애플리케이션은 마이크로서비스 아키텍처의 다양한 장점을 누릴 수 있느느데, 이를테면 핵심 기능을 작고 독립된 단위로 만들어 따로따로 다루면서 변경 내용을 빠르게 테스트할 수 있다. 이는 애플리케이션 전체를 변경한 게 아니라 해당 기능이 포함된 컨테이너만 변경했기 때문에 가능하다. 또한 해당 기능의 확장성을 조절할 수도 있고, 필요에 맞는 적절한 기술 기반을 선택할 수도 있다.

## 클라우드 환경에 적합한 새로운 애플리케이션 개발하기
도커는 분산 애플리케이션이든 모놀리식 설계이든 간에 기존 애플리케이션을 클라우드로 마이그레이션하는 데에 유용하다. 통짜 애플리케이션이라면 도커를 통해 컴포넌트를 분할하고 새로운 설계를 적용해 클라우드나 데이터센터 어느 곳에서든 운영할 수 있으며, 클라우드 환경을 고려한 완전히 새로운 애플리케이션 개발이라면 도커를 통해 더 빠른 개발이 가능하다.

## 기술 혁신: 서비리스와 그 너머
현대 IT 기술을 주도하는 요소 중 하나는 일관성이다. 개발팀은 모든 프로젝트에서 같은 도구, 같은 프로세스, 동일한 런타임을 사용하는 걸 원한다. 그리고 니즈는 도커를 사용하면 해결된다. 닷넷 애플리케이션도, Go 애플리케이션도 컨테이너에서 실행이 가능하다. 도커 클러스터를 구축하면 모든 제품의 빌드, 배포, 운영을 같은 도구와 같은 방법으로 수행할 수 있다.

컨테이너 도입후 마주할 가장 흥미진진한 기술 혁신은 서버리스 함수다. 서버리스 기술을 곧 컨테이너 기술이다. 개발자에서 있어 서버리스 기술을 사용해 이루려고 하는 목표는, 함수 코드를 작성하고 서비스에 푸시하면 서비스가 코드를 빌드하고 패키징하도록 하는 것이다. 함수 사용 측에서 함수를 호출하면 서비스는 해당 함수의 인스턴스를 생성해 요청을 처리한다. 이 과정에서 빌드 서버도, 파이프라인도, 관리가 필요한 운영 환경도 필요 없다. 모든 일은 플랫폼이 처리한다.

클라우드 서버리스 서비스의 수면 아래에서 도커가 실제로 코드를 패키징하고 함수를 실행하는 역할을 담당하고 있다. 그리나 클라우드 환경의 함수는 이식성이 없다. 다시 말해 AWS 람다 함수를 애저로 그대로 옮길 수는 없다는 말이다. 그 이유는 서비리스에 개방형 포준이 아직 없기 때문이다. 특정 클라우드에 종속되는 일 없이 서버리스 기술을 활용하고 싶거나 데이터센터를 직접 운영하고 있다면, 유명 서버리스 프레임워크인 누클리오나 오픈파스 Fn 프로젝트와 도커를 활용해 직접 플랫폼을 구축할 수 있따. 

## 데브옵스 도입하기
앞서 살펴본 시나리오는 모두 기술과 관련된 것들이다. 그러나 대부분의 조직이 직면하는 가장 큰 문제는 역시 운영이다. 특히 역사가 깊고 규모가 큰 조직일수록 더욱 그렇다. 기술 조직은 '개발'팀과 '운영' 팀으로 나뉘어 프로젝트의 생애주기의 서로 다른 부분을 각각 담당한다. 출시 시점의 문제점은 개발 팀과 운영 팀이 서로 책임을 미루게 되기 쉽다. 그래서 이후 발생할 수 있는 문제를 방지하기 위해 이 시점에 품질 게이트를 둔다. 그러다 보면 점점 늘어나는 품질 게이트로 인해 불어나는 위험과 작업량을 감당하지 못해 한 해에 한 두번밖에 출시하지 못하게 된다.

데브옵스는 기민한 소프트웨어 유지 보수를 위해 애플리케이션의 전체 생애주기를 담당하는 전담 팀이다. 이름부터가 '개발'과 '운영'을 합친 것이다. 이들이 하는 일은 주로 분기별 대규모 릴리즈를 작은 규모의 일일 배포로 대처하는 일이다. 아무런 기술적 변화 없이 이를 실현하기는 어렵다.

운영자는 Bash, 나기오스, 파워쉘, 시스템 센터 등의 도구를 다루며, 개발자는 메이크, 메이븐, 누겟, MS빌드 등의 도구를 주로 사용한다. 서로 다른 기술을 사용하는 사람들끼리 어떻게 하나의 팀을 이룰 수 있을까? 여기서 도커의 진가가 발휘된다. 컨테이너로의 전환을 통해 데브옵스 도입을 더욱 촉진할 수 있고, 팀원 모두가 Dockerfile과 도커 컴포즈 스크립트를 사용하면 같은 기술과 도구로 팀을 통일할 수 있다. 

장점은 이뿐만이 아니다. 배포 프로세스와 운영 로그로부터 얻은 측정치를 쉽게 활용할 수 있고 도커 허브는 이미 잇는 것을 다시 만드는 노력을 절약할 수 있게 한다.
