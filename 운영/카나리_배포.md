#  카나리 배포

카나리 배포라는 이름의 유래는 과거 탄광에서 위험 가스를 감지하기 위해 Canary라는 새를 데리고 왔던 것에서 왔다. 유래가 이러하듯 이 방식은 소프트웨어의 새로운 버전을 소규모의 사용자 그룹에게만 먼저 배포를 해서 문제 발생 여부를 확인하고 문제가 없다고 판단되면 점진적으로 배포 범위를 넓혀 나간다.

카나리 배포는 롤링 배포와 닮아있지만 차이점이 있다. 롤링 배포는 새로운 버전을 전체 서버에 배포하는 것이고 카나리 배포는 새로운 버전을 일부 사용자에게만 배포하는 것이다. 카나리 배포는 새로운 버전을 일부 사용자에게만 배포하고 문제가 없다고 판단되면 점진적으로 배포 범위를 넓혀나간다.

카나리 배포는 일부 서버에 배포하는 것도 가능하고 일부 사용자에게만 배포하는 것도 가능하다. 일부 사용자에게만 배포하려면 동일한 사용자가 계속해서 같은 서버에 접속되게끔 포워딩되도록 처리하면 된다. 동일한 사용자가 접근하는 것을 판단하기 위해 사용자가 가지고 있는 특정한 속성을 이용하거나 쿠키, 세션을 이용할 수 있다. id 값을 해싱한다던지, 연령이나 지역같은 걸 가지고 포워딩되는 서버의 기준을 나누는 것도 선택해볼 수 있다. 그리고 일부 서버에만 배포하려면 로드밸런서에 의해 처리되도록 하면 된다.

그러다 버전에 문제가 있는게 확인되면 그 버전이 배포된 곳마다 롤백을 시킨다. 

## 장점

1. 위험을 최소화할 수 있다.
    1. 새로 오픈한 기능이 성능 측면에서 걱정되는 게 있다면 카나리 배포를 함으로써 트래픽을 점진적으로 늘려가면서 새로운 버전을 사용하는 사용자의 비율을 늘려나갈 수 있다.

## 단점

1. 설정과 관리가 복잡하다.
   1. 어느정도냐면 카나리 배포를 구성하기 위한 별도의 툴을 활용할 정도이다. 
2. 특정 사용자 그룹만 새로운 기능을 사용할 수 있기 때문에 사용자 경험이 일관되지 않을 수 있다.