# 블루그린 배포

블루그린 배포는 새로운 버전을 별도의 환경에 배포하고 즉시 전환하는 방법이다. 현재 서비스 중인 환경이 블루라면 새로운 버전은 그린 환경이 되는 것이다. 블루와 그린은 그저 순서를 번갈아 가며 사용할 뿐 꼭 현재 버전을 블루라고 부르는 건 아니다.

## 동작 방식

현재 운영을 하고 있는 환경이 블루라고 하자. 

1. 그린 환경에 블루 환경과 완전히 동일한 환경을 구축한다.
2. 그렇게 구축한 그린 환경에 새로운 버전의 소프트웨어를 배포한다.
3. 그린 환경에서 CD 테스트를 해보고, 때론 사람이 직접 테스트한다. 아직까지는 블루 환경으로만 트래픽이 포워딩 되고 있는 상태이다.
4. 그린 환경에서 모든 것들이 동작한다고 확인되면 그린 환경으로 트래픽을 포워딩한다.
   1. 이 전환은 보통 로드밸런싱 설정을 변경하는 것으로 이루어진다. 중요한 것은 블루 환경에서 그린 환경으로의 전환은 즉시 이루어져야 한다.
   2. 전환이 이루어진 후에 블루 환경은 더 이상 트래픽을 받지 않는다. 하지만 그린 환경에서 예상치 못한 문제가 발생할 수 있으므로 일정 기간 블루 환경을 유지한다.
      1. 그린 환경에 문제가 생기면 로드밸런싱 설정을 변경하는 것처럼 즉시 전환을 하는 방식으로 롤백한다.

## 장점

1. 즉각적인 전환과 롤백이 가능하다. 
2. 새로운 버전을 실제 환경과 동일한 환경에서 테스트해볼 수 있다.
   1. 모든 테스트를 충분히 해볼 수 있기 때문에 문제 발생 가능성을 크게 줄일 수 있다.
   2. 데이터베이스나 외부 API를 사용하는 경우에도 실제 환경과 동일한 환경에서 테스트할 수 있다. 하지만 트래픽이 몰릴 때는 따로 처리해줘야 할 필요가 있다.

## 단점

1. 서버가 두 배로 필요해서 비용이 거의 두 배로 든다.
2. 설정하고 관리하기가 복잡하다.
    1. 배포할 때마다 두 개의 서버군에 대한 로드밸런서 설정, 네트워크 구성, 모니터링 시스템 등을 신경 써야 한다.
    2. 이 전환을 빠르게 하기 위해 자동화 스크립트나 도구를 따로 개발하고 유지보수해야 할 수도 있다.