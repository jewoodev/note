# 헥사고날 아키텍처의 사실
헥사고날 아키텍처는 애플리케이션 아키텍처로 선택할 수 있는 것 중 하나이다.

이는 계층형 아키텍처의 단방향 비대칭 구조가 아닌 대칭형 구조를 갖는 아키텍처로, 위 아래, 좌 우가 아닌 **애플리케이션의 내부와 외부 세계**라는 **대칭 구조**를 갖는다.

그리고 이름에서 알 수 있듯 아키텍처가 육각형의 형태로 그려지는데 대칭성을 가진 형태를 나타내는 것에 초점이 맞춰져 있지, 육각형에 큰 의미는 없다.

## 헥사곤의 내부
헥사고날 아키텍처에서 육각형 내부, 즉 애플리케이션 내부를 **헥사곤의 내부**라고 부른다. 이 헥사곤 내부는 쉽게 변하지 않는, **중요한 도메인 로직**을 담은 **코어**이다.  
따라서 이 내부에는 다음과 같은 것들이 들어올 수 있다.
- 도메인 로직을 가진 트랜잭션 스크립트
- '애플리케이션 서비스'와 '도메인 모델 패턴을 따라 만든 도메인'

## 헥사곤의 외부
헥사곤의 외부에는 이 헥사곤과 상호작용하는 것들이 있다. 그런 상호작용하는 모든 것들을 **액터(Actor)**라고 주로 부른다.  
액터라는 것은 어떤 의도를 갖고 시스템과 상호작용하는, 스스로 어떤 행위를 할 수 있는 모든 것들을 다 통칭하는 건데 대표적으로 다음과 같은 것이 액터라고 볼 수 있다.
- 사용자, 브라우저, CLI 명령, 기계, 다른 시스템
- 운영 환경, DB, 메세징 시스템, 메일 시스템, 원격 서비스
- 테스트

## 헥사고날 아키텍처의 특징과 혜택
- 운영 시스템에 연결되지 않고 애플리케이션을 테스트 할 수 있어 **테스트**를 만드는데 용이하다.
- 이 아키텍처의 창시자가 테스트를 잘 하기 위해 만들었다고 했을 만큼 테스트가 이 설계에서 갖는 비중이 크다. **테스트를 만들지 않으면 헥사고날 아키텍처를 하는게 아니다**. 
- 애플리케이션과 상호작용하는 액터가 바뀌어도 다시 빌드하지 않고 테스트할 수 있다.
- UI 기술 정보나 자세한 정보들이 도메인 로직 안으로 노출되지 않도록 보호되어야 하고, 그 반대로도 보호되어야 한다. 그렇지 않으면 헥사고날 아키텍처가 아니다. 
- 큰 시스템을 분리해서 여러 개의 컴포넌트로 만들고, 각각의 컴포넌트를 독립적으로 개발한 다음에 손쉽게 연결할 수 있도록 할 수 있다.
- 필요하다면 외부 연결을 다른 것으로 손쉽게 변경할 수 있다.
- 기술 요소를 제거했기 때문에 도메인 설계에 집중할 수 있다.

## 헥사곤을 부르는 여러가지 이름
- 헥사곤
- 애플리케이션
- 앱(App)
- 코어 시스템
- SuD(System under Development)
- SuT(System under Test)

## 포트(port)
- 애플리케이션이 외부 세계와 의도(intention)를 가지고 상호작용하는 것들
- 단순히 데이터를 주고받는 게 아니라, 명확한 목적과 방향을 가지고 외부와 연결됨

포트는 결국 애플리케이션이 가지고 있는 인터페이스를 말하는데 그러한 인터페이스는 크게 두 가지 종류로 나뉜다.

### 인터페이스
이 인터페이스에는 다이어그램으로 그려서 표현할 때 사용하는 두 가지 이름이 있다.
- Lollipop: Provided Interface (애플리케이션이 외부에 기능을 **제공**하는 인터페이스)
- Socket: Required Interface (애플리케이션이 필요로 하는 기능을 외부에게 **요구**하는 인터페이스)

Required Interface에 연결될 수 있는 걸 Secondary Actor라고 한다.

## 어댑터(Adapter)
- 애플리케이션의 포트(인터페이스)를 액터가 직접 연결(사용)할 수 없다면 **인터페이스의 변환**을 위한 어댑터를 도입함
- 브라우저를 통해 애플리케이션의 회원 가입 포트의 기능 제공 인터페이스를 사용하려면?
  - 회원 가입 *기능 제공 인터페이스*를 사용하는 웹 컨트롤러 어댑터를 만듬
- 애플리케이션이 가진 회원 정보 저장 포트의 기능 요규 인터페이스로 DB와 직접 연결할 수 없다면?
  - 기능 요구 인터페이스를 구현한 리포지토리 어댑터를 만듬

## 포트와 어댑터 아키텍처
- 헥사고날 아키텍처의 특징을 담은 새로운 이름
- 하지만 여전히 헥사고날 아키텍처라는 이름이 더 많이 사용됨

## 헥사고날 아키텍처의 비대칭성
- 애플리케이션이 제공하는 기능을 사용하는 액터와 이를 위한 어댑터
  - primary actor, primary adapter
  - driving actor, driving adapter
- 애플리케이션이 동작하는데 필요한 기능을 제공하는 액터와 이를 위한 어댑터
  - secondary actor, secondary adaptor
  - driven actor, driven adapter

# 헥사고날 아키텍처의 오해
## 애플리케이션 내부에 도메인 계층을 만들어야 한다
- 헥사고날 아키텍처는 애플리케이션 내부 구현에 대한 요구사항이나 원칙이 없다
  - 스파게티 코드로 만들어도 ok
  - 트랜잭션 스크립트, 도메인 모델 패턴과 애플리케이션 서비스, 그 외 등등도 ok
  - 도메인 계층을 포함하는 아키텍처는 클린 아키텍처이다
- 헥사고날 아키텍처는 클린 아키텍처, 어니언(onion) 아키텍처가 아니다

## 헥사고날 아키텍처 패키지 구조를 따라야 한다
- 헥사고날 아키텍처가 요규하는 패키지 구조는 없다
- 애플리케이션과 어댑터 패키지를 분리하는 것은 바람직하다
- 포트를 구분된 패키지에 두는 것을 권장한다

## 포트는 UseCase라는 접미사를 사용한다
- 포트는 **포트의 의도**를 담은 이름을 사용하면 된다
- For+~ing 스타일의 권장 네이밍 규칙이 있지만 이를 따를 필요는 없다

## 애플리케이션에는 도메인 모델만 넣고 JPA 엔티티 등은 어댑터에 둬야 한다
이 오해는 헥사고날 아키텍처랑 아무 관련이 없다.
- 애플리케이션 코드와 포트 인터페이스가 외부 기술에 의존하지 않아야 한다.

# 사실: 헥사고날 아키텍처가 요구하는 것
- 애플리케이션은 모든 외부와의 상호작용을 위해 *provided interface*와 *required interface*를 정의한다.
- 애플리케이션과 상호작용하는 **액터는 런타임에 구성**되어야 한다.
- 애플리케이션은 액터에 대한 코드 의존성을 가지면 안 된다.
- 포트의 인터페이스는 기술 의존성을 가지면 안 된다.

# 헥사고날 아키텍처와 도메인 모델 패턴을 적용한 대칭형 계층 구조
- 도메인 계층
- 애플리케이션 계층
- 어댑터 계층

[Explicit Architecture](https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/)

- 외부에서 내부로 향하는 일종의 계층 구조
- 코드의 의존 방향은 내부로만 향한다  
  [어댑터] -> [애플리케이션] -> [도메인]
- 단, 사용의 흐름은 비대칭적이다