# 메모리 구조

MySQL은 메모리를 크게 글로벌 메모리 영역과 로컬 메모리 영역으로 나눠 사용한다. 글로벌 메모리 영역의 모든 메모리 공간은 MySQL 서버가 시작되면서 운영체제로부터 할당된다. 운영체제 종류에 따라 다르겠지만 요청된 메모리 공간을 100% 할당해줄 수도 있고, 그 공간만큼 예약해두고 필요할 때 조금씩 할당해주기도 한다. 각 운영체제가 메모리를 할당하는 방식은 상당히 복잡하고, MySQL 서버가 사용하는 메모리 공간을 정확하게 파악하기 어렵다. 그냥 MySQL의 시스템 변수로 설정해둔 만큼 할당받는다고 간단히 생각해도 좋다.

## 글로벌 메모리 영역

클라이언트 스레드 수와 무관하게 하나의 메모리 공간만 할당된다. 필요에 따라서 2개 이상의 메모리 공간을 할당받는 것도 가능하지만, 그러더라도 N개의 영역 모두 모든 스레드에게 공유된다. 대표적인 영역들은 아래와 같다.

- 테이블 캐시
- InnoDB 버퍼 풀
- InnoDB 어댑티브 해시 인덱스
- InnoDB 리두 로그 버퍼

## 로컬 메모리 영역

MySQL 서버 상에 있는 클라이언트 스레드가 쿼리를 처리하기 위해 사용하는 메모리 영역으로, 세션 메모리 영역이라고도 부른다. 대표적으로 커넥션 버퍼와 정렬 버퍼가 포함된다. 

로컬 메모리는 각 클라이언트 스레드 별로 독립적으로 할당되고 절대 공유되지 않는다. 글로벌 메모리 영역과 마찬가지로 메모리 부족 현상을 야기할 수 있기 때문에 적절한 메모리 크기로 설정하는 것이 중요하다. 

영역의 용도가 스레드가 쿼리를 처리하기 위함에 있기 때문에 동적인 할당이 이루어진다는 특징이 있어서, 쿼리가 어떤 것이냐에 따라 공간이 필요하지 않으면 할당이 이루어지지 않기도 한다. 또 커넥션이 열려 있는 동안 계속 할당된 상태로 남아 있는 공간이 있고(커넥션 버퍼 or 결과 버퍼) 쿼리를 실행하는 순간에만 할당했다가 해제하는 공간도 있다(소트 버퍼나 조인 버퍼).

대표적인 것들은 아래와 같다.

- 정렬 버퍼
- 조인 버퍼
- 바이너리 로그 캐시
- 네트워크 버퍼

