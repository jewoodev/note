우리는 보통 다른 컴퓨터에 데이터를 전송할 때 IP만을 이용해서 전송한다. 하지만 실제로 전송할 때는 데이터링크 계층에서 MAC 주소로 바꿔 전송한다. 우리는 통신하려는 목적지 컴퓨터의 IP 주소는 알아도 MAC 주소는 모르기 때문에 통신이 불가능해보인다. 그럼에도 통신이 가능한 건 ARP(Address Resolution Protocol) 덕분이다. 

# ARP
IP 주소로 MAC 주소를 알아내는 프로토콜이다. 

## 동작 방식
통신하려는 목적지 컴퓨터의 IP 주소만 알고 MAC 주소를 모를 때

1. 우리의 PC는 **ARP 요청 메세지**라는 걸 만들고 출발지 IP에 우리 PC의 IP, 목적지 IP엔 목적지 IP를 적는다.
2. 이제 데이터링크 계층에서 MAC 주소를 적어줘야 한다.
   1. 출발지 MAC 주소엔 우리 PC의 MAC 주소를 적고, 목적지 MAC 주소는 브로드캐스트 주소를 적는다.
3. 데이터가 스위치에 도착하면 스위치는 목적지 MAC 주소를 확인하고 브로드캐스트 메세지인 걸 알아차린다.
4. 브로드캐스팅된 메세지는 목적지 IP 주소를 확인하고
   1. 자신의 메세지가 무시해버리고, 자신의 IP라면 **ARP 응답 메세지**를 보낸다. 
   2. ARP 응답 메세지에 출발지 IP는 자신의 IP, 목적지 IP는 ARP 요청 메세지의 출발지 IP를 적는다.
      1. MAC 주소도 IP를 적은 것과 동일하게 출발지 -> 자신, 목적지 -> ARP 요청 메세지의 출발지 MAC을 적는다.
      2. ARP 응답 메세지를 전송한 PC는 전송과 동시에 ARP 요청 메세지의 출발지 IP와 MAC 주소를 **ARP 캐시**라는 곳에 저장해둔다.
5. 우리의 PC는 ARP 응답 메세지를 받는다.
   1. ARP 응답 메세지의 출발지 IP와 MAC 주소를 ARP 캐시라는 곳에 저장해둔다.

### 비효율적인 것 아닐까?
ARP의 동작 방식은 브로드캐스트를 동반하기에 비효율적인 것으로 보인다. 허브의 단점을 해결한 스위치의 특징이 사라지는 것으로도 보인다. 하지만 한 번 MAC 주소를 알아내고 나면 그 다음부턴 브로드캐스팅하지 않기 때문에 그러한 비효율성은 크지 않다.

## 라우터를 건너 통신해야 할 땐 어떻게 해야할 까?
이 땐 라우터가 도와준다. 라우터는 ARP 요청 메세지를 받게 되면 메세지의 목적지 IP가 자신의 IP 주소가 아니더라도 그 메세지에 응답한다.

1. ARP 응답 메세지에 출발지 IP -> 자신의 IP, 목적지 IP -> ARP 요청 메세지의 출발지 IP 
   1. MAC 주소도 IP와 동일하기 출발지 -> 자신, 목적지 -> ARP 요청 메세지의 출발지 MAC을 적는다.
2. 그럼 우리 PC의 ARP 캐시엔 라우터 건너에 있는 PC의 MAC 주소는 ARP 요청 메세지가 처음으로 만나는 라우터의 MAC 주소가 저장된다.
   1. 이런 역할을 하는 라우터를 디폴트 라우터라고 한다.

> ### 디폴트 라우터
> 다른 네트워크(인터넷)로 나가는 경로를 알고 있는 라우터
> - 일반적으로, 다음의 것들에 해당한다.
>   - 호스트에 직접 연결된 라우터
>   - 통상, 외부와 단 하나의 입출구만 있는 경우에 그곳에 위치한 라우터
>   - 또는, 여러 입출구 중 기본 디폴트 라우터로 지정된 것