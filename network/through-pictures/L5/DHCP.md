컴퓨터를 인터넷에 연결하려면 '내가 속하려는 LAN의 라우터와 같은 네트워크'에서 겹치지 않는 IP 주소를 선택해 PC에 설정해야 한다. 하지만 '인터넷을 연결하려는 사람'은 '다른 사용자와 겹치지 않는 IP 주소'를 알 방법이 없으므로 네트워크 관리자에게 그러한 IP 주소를 알려달라고 요청해야 한다. 관리자가 IP 주소를 알려주면 컴퓨터 네트워크 설정창에서 IP 주소를 입력해줘야 한다. 이런 걸 해야하는 건 하여간 힘든 일이다.

노트북을 가지고 카페에 가서 인터넷에 접속하려고 한다면 더 복잡해진다. 우리는 카페의 와이파이를 이용하기 위해 해당 네트워크의 적절한 IP로 설정해야 한다. 이때도 네트워크 관리자에게 문의해야 하는데, 카페 직원이 이런 문의를 처리해줘야 한다면 굉장히 머리아파질 것이다. 이렇듯 IP 주소를 사람이 일일이 설정하는 건 매우 번거로운 작업이다. 이런 이유로 개발된 프로토콜이 DHCP(Dynamic Host Configuration Protocol)이다.

DHCP는 사용자와 관리자의 역할을 대신해주는 프로토콜로 애플리케이션 계층에 속한 프로토콜이다. 즉, 호스트의 IP를 컴퓨터가 적절한 IP를 찾아 (자동으로) 설정해주는 기능이다.

보통 DHCP는 따로 DHCP 서버를 두거나, 라우터에 포함되어 있다. 

# DHCP Discovery
호스트가 DHCP 서버에 IP 주소를 요청하기 위해 브로드캐스트 메세지를 보내는 것을 말한다. 이때 보내는 메세지는 아래와 같은 형태를 띈다.

```
출발지 IP: 0.0.0.0 
목적지 IP: 255.255.255.255
출발지 MAC: AA:AA:AA:AA:AA:A1
목적지 MAC: FF:FF:FF:FF:FF:FF
```
출발지 IP는 아직 없으므로 `0.0.0.0`으로 적고, 목적지 IP는 브로드캐스트 주소를 적는다. 그리고 출발지 MAC 주소는 실제 호스트 MAC 주소를 적고, 목적지 MAC 주소는 브로드캐스트 주소를 적는다.

# DHCP Offer
DHCP 서버가 호스트의 요청에 IP를 제안하는 것을 말한다. 

브로드캐스팅을 거쳐 DHCP 서버에 디스커버리 메세지가 오면 

- 출발지 IP는 라우터의 IP,
- 목적지 IP는 할당하려는 IP
- 출발지 MAC은 라우터의 MAC
- 목적지 MAC은 요청한 호스트의 MAC

위와 같이 적어 전송한다.

# DHCP Request
> DHCP 서버에 해당 IP 주소를 요청하는 것을 말한다.

오퍼 메세지를 호스트가 받게 되면 호스트는 다시 DHCP 서버에 응답 메세지를 보낸다. 출발지 IP 주소는 아직 확정된 것이 아니여서 다음과 같이

```
출발지 IP: 0.0.0.0 
목적지 IP: 255.255.255.255
출발지 MAC: AA:AA:AA:AA:AA:A1
목적지 MAC: FF:FF:FF:FF:FF:FF
```
처음 보냈던 메세지와 동일한, 목적지 IP와 MAC 주소가 브로드캐스트 주소인 메세지를 보낸다. 여기서 이상한 점을 느낄 수 있다. 이제는 DHCP 서버의 IP와 MAC 주소를 아는데 왜 브로드캐스팅을 하는걸까?

그 이유는 같은 네트워크에 DHCP 서버가 여러 개 있을 수도 있기 때문이다. 호스트는 네트워크 내에 있는 모든 DHCP 서버에 해당 오퍼를 받아들여 사용하려고 한다는 것을 알리는 것이다.

# DHCP ACK(Acknowledge)
> 최종적으로 해당 IP를 할당한다고 알리는 것을 말한다. 

리퀘스트 메세지를 DHCP 서버가 수신하면 다시 요청-호스트에게 응답 메세지를 보낸다. 

```
출발지 IP: 10.0.0.1 (Router)
목적지 IP: 10.0.0.2 (할당할 IP)
출발지 MAC: AA:AA:AA:AA:AA:AA (Router)
목적지 MAC: AA:AA:AA:AA:AA:A1
```