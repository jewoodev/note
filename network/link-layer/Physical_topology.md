지금까지 LAN, MAC_address, MAC_protocol 문서에서 살펴본 링크 계층에서 broadcast medium은 bus 구조로 모든 노드가 같은 collision domain에 속하는 것으로 가정했다. 오늘 날에는 그 구조가 아닌 star 구조를 채택하며 중앙에 "스위치" 라는 링크 계층 장비를 둬서 모든 노드가 독립된 collision domain을 가질 수 있게 각각의 링크를 분리시킨다.

스위치의 특징은 '호스트 입장에서는 스위치가 안보인다'는 것이다. 이 말은 호스트가 링크 계층 통신을 할 때 내 앞에 스위치가 있는지 없는지 모른 채로 CSMA/CD를 수행하며 통신을 수행한다는 걸 의미한다. 스위치는 MAC address도 없고 IP address도 없고, 더 나아가서도 아무것도 없다. 연결만 시켜줄 뿐이다.

# Switch forwarding table
중앙에 스위치가 위치한 star 구조에서는 각 호스트의 링크는 독립된 collision domain을 갖기 때문에 항상 프레임을 전송할 수 있게 된다. 이럴 때 동시에 두 호스트가 하나의 dest로 프레임을 보내려고 한다면 스위치가 동시에 각 포트로 프레임을 수신해도 하나씩 dest로 보낸다. 따라서 스위치도 포워딩을 수행한다! 이 포워딩을 수행하기 위해 스위치도 포워딩 테이블을 갖는다. 그럼 스위치 테이블의 엔트리는 어떻게 채워질까? 라우터는 라우팅 알고리즘을 수행해서 채워지는데, 스위치는 라우터가 아니지 않은가.  

그것은 self learning 이라는 아주 단순한 기법을 통해서 스위치 테이블을 채운다. 이 기법은 스위치에 프레임이 수신될 때마다 테이블을 채우는 기법이다. 만약 A 호스트의 링크가 스위치의 1번 포트에 연결되어 있고, A 호스트가 B 호스트를 dest 로 설정해 프레임을 보내면 스위치는 다음과 같이 테이블을 채운다. 

| MAC addr | interface | TTL |
|----------|-----------|-----|
| A        | 1         | 60  |

그 후 스위치는 B 호스트에 프레임을 보내는 시도를 하게 되는데 아직 포워딩 테이블에 B 호스트로 포워딩하려면 어떤 인터페이스로 내보내면 되는지 모르기 때문에 1번 포트를 제외한 모든 포트에 플러딩(flooding)한다. 이후에 B 호스트로부터의 프레임이 스위치에 도달하면 그때 포워딩 테이블에 B 호스트의 MAC addr 에 매칭되는 엔트리가 채워진다.

실제 LAN은 내부의 다수의 호스트들이 몇 개 단위로 나뉘어 스위치로 묶이고 그 스위치들을 묶는 또다른 스위치로 이어지며 구조를 형성한다. 그리고 그 끝에 게이트웨이 라우터가 위치한다.

우리 가정집에서 사용 중인 네트워크 환경의 구조를 바라보면 통신사에서 집 근처까지 연결된 케이블을 통해 집까지 선이 들어와서 그걸 무선 공유기라는 것에 연결하면 와이파이가 공간에 제공되는 형태를 갖는다. 원래는 컴퓨터에 연결해야 하는데 무선 공유기라는 작은 장치에 연결하는 것으로 대체할 수 있는 이유는 무선 공유기가 작은 컴퓨터이기 때문이다. 내부적으로 링크, 네트워크, 전송, 애플리케이션 계층이 작은 장치 안에 다 들어가 있다. 이 무선 공유기는 애플리케이션 계층에서 NAT, DHCP, DNS 를 모두 수행한다. 게이트웨이 라우터의 역할을 맡으면서 라우터만의 역할이 아니라 필요로 하는 기능들이 추가로 탑재된 장치라고 보면 된다.