## 1. 계층 구조

네트워크를 여러 계층으로 나누는 형태는 우리의 일상생활에서 만나볼 수 있는 것들과 닮아있다. 예를 들어, 우리가 해외 여행을 가기 위해선 공항의 아래와 같은 (일정한) 순서를 거쳐야 한다. 이 예시를 통해 계층 구조가 가져다 주는 이점을 이해해보자.

1. '티켓을 구매하거나 받으러 가는 카운터 혹은 단말기에서 티켓을 구매하거나 받기'
2. '티켓 확인'
3. '수하물 검사 및 통관 검사 하기'
4. '탑승구를 통해 탑승하기'
5. '활주로 이륙'
6. '비행기 운행(라우팅)'
7. '활주로 착륙'
8. '탑승구를 통해 하차하기'
9. '수하물 꺼내기'

3번에 해당하는 작업은 유효한 티켓을 가진 고객만을 대상으로 이루어진다. 4번에 해당하는 작업도 동일하다. 각 계층은 그 계층에서 어떤 동작을 취하고 그 계층 바로 아래 계층의 서비스를 이용함으로써 전체 서비스를 제공한다. 

이처럼 계층 구조는 크고 복잡한 시스템의 잘 정의된 특정 부분에 대해서만 논의할 수 있게 해준다. 이는 각 계층이 제공하는 서비스의 구현을 변경하는 것이 쉽다는 것을 의마한다. 한 계층이 상위 계층에 같은 서비스를 제공하고 하위 계층의 서비스를 이용하는 한, 어떤 한 계층의 구현이 변하더라도 시스템의 나머지 부분에 영향을 미치지 않는다. 

### 1.2 프로토콜 계층화

프로토콜 계층화도 같은 맥락이다. 네트워크 통신이 잘 이루어지기 위해 수행되어야 할 작업의 흐름을 잘 정의해두고 특정 부분을 포함하는 각각의 계층으로 나누어 시스템 구성요소의 갱신이 더 쉬워지도록 만든다. 

몇몇의 연구자와 네트워크 기술자는 계층화의 결점들을 지적하며 계층화에 반대한다. 여기서 말하는 결점들은 아래와 같다.

1. 한 계층의 기능이 하위 계층과 기능적으로 중복된다.
   - ex. 데이터 링크 계층에 오류 제어 기능이 있는데, 물리 계층에서도 오류 제어 기능이 있음.
2. 어느 한 계층의 기능이 다른 계층에만 존재하는 정보를 필요로 할 수 있다.
   - 이는 계층을 분리하는 목적에 위배됨.

계층화에 대한 다른 시선도 있다는 것을 기억해두자. 이러한 다양한 계층의 프로토콜은 묶어서 프로토콜 스택이라고 불리곤 한다. 인터넷 프로토콜 스택은 5개 계층으로 구성된다. 

1. 애플리케이션 계층
2. 트랜스포트 계층
3. 네트워크 계층
4. 링크 계층
5. 물리 계층

### 1.3 애플리케이션 계층

애플리케이션 계층 프로토콜은 여러 종단 시스템에 분산되어 있어 한 종단 시스템의 애플리케이션이 다른 종단 시스템의 애플리케이션과 정보 패킷을 교환하는데 사용된다. 애플리케이션 계층에선 이 정보 패킷을 **메세지**(message)라고 부른다.

### 1.4 트랜스포트 계층

클라이언트와 서버 간 애플리케이션 계층 메세지를 전송하는 서비스를 제공한다. 트랜스포트 프로토콜 중 하나인 TCP는 긴 메세지를 짧은 메세지로 나누고 혼잡 제어 기능을 제공해서 네트워크가 혼잡할 때 출발지의 전송율을 줄이게끔 한다. 이 계층에서의 패킷을 **세그먼트**(segment)라고 한다.

### 1.5 네트워크 계층

한 호스트에서 다른 호스트로 **데이터그램**(datagram)을 라우팅하는 역할을 수행한다. 그래서 출발지 호스트는 세그먼트와 목적지 주소를 네트워크 계층으로 전달한다. 그럼 네트워크 계층은 그 정보를 가지고 호스트의 트랜스포트 계층으로 세그먼트를 운반하는 서비스를 제공한다. 

이 계층은 두 가지 주요 요소를 제공한다. 

1. IP **데이터그램의 필드**를 정의하며 종단 시스템과 라우터가 이 필드**에 따라 어떻게 동작하는지**를 정의하는 **프로토콜**
2. 출발지와 목적지 사이에서 데이터그램이 이동하는 경로를 결정하는 **라우팅 프로토콜**

### 1.6 링크 계층

네트워크 통신에 사용되는 경로, 그 경로 상의 한 노드에서 다른 노드로 패킷을 이동시키기 위해 네트워크 계층은 링크 계층에 의존해야 한다. 네트워크 계층은 데이터 그램을 링크 계층으로 보내고, 링크 계층은 받은 데이터그램을 경로 상의 다음 노드에 전달한다. 다음 노드에서 링크 계층은 그 데이터그램을 상위 네트워크 계층으로 보낸다. 

링크 계층에서 제공하는 서비스는 그 링크에 적용된 특정 링크 계층 프로토콜이 결정한다. 예시로 신뢰적인 전송을 제공할 수 있다. 하지만 이는 TCP의 신뢰적인 서비스와는 다르다는 것을 유의하자. 

링크 계층 프로토콜은 이더넷, 와이파이 그리고 케이블 접속 네트워크의 DOCSIS 프로토콜이 있다. 데이터그램이 목적지까지 가는데 여러 링크를 거치기 때문에 데이터그램은 여러가지 링크 계층 프로토콜에 의해 처리될 수 있다. 링크 계층 패킷은 **프레임**(frame)이라고 한다. 

### 1.7 물리 계층

링크 계층의 기능이 전체 프레임을 노드에서 노드로 이동시키는 것이라면 물리 계층의 기능은 프레임 내부의 각 비트를 노드에서 노드로 이동시키는 것이다. 이 계층의 프로토콜은 링크에 의존하고 링크의 실제 전송 매체에 의존한다. 각각의 경우에 비트는 다른 방식으로 링크 반대편으로 이동된다.

## 2. 캡슐화

계층마다 자신의 역할을 수행하기 위해 필요로 하는 정보가 다르다. 

애플리케이션 계층에서는 메세지만 있으면 되지만 트랜스포트 계층에선 애플리케이션 계층에서 전달받은 메세지에 수신 측이 필요로 할 정보를 헤더에 담는다. 여기에는 수신 측의 트랜스포트 계층이 그 메세지를 적절한 애플리케이션으로 보내는데 필요한 정보와 메세지의 비트들이 변경되었는지 여부를 수신자가 판단하는데 필요한 오류 검출 비트가 있다.

다음으로 네트워크 계층에서는 트랜스포트 계층에서 전달받은 세그먼트에 출발지와 목적지 종단 주소와 같은 정보를 헤더에 담아 데이터그램을 만든다. 

이렇듯 송신 측의 계층에서 수신 측의 같은 계층이 필요로 할 정보를 담고, 수신 측은 역으로 그 정보를 꺼내 말미엔 애플리케이션 계층에서 메세지만으로 구성된 패킷을 사용하는데, 이 과정을 **캡슐화**(전자)와 **역캡슐화**(후자)라고 한다. 


