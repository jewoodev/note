# 단위 테스트의 정의
단위 테스트의 정의는 많이 존재한다. 그것들 중 중요하지 않은 것들을 제외시키고 가장 중요한 세 가지 속성을 꼽으면,

1. 작은 코드 조각(혹은 단위)을 검증하고,
2. 빠르게 수행하고,
3. 격리된 방식으로 처리하는 자동화된 테스트다.

여기서 첫 두 속성은 논란의 여지가 없다. 대중의 의견이 크게 달라지는 건 세 번째 속성이다. 격리 문제는 단위 테스트의 고전파와 런던파를 구분할 수 있게 해주는 근원적 차이에 속한다. 두 분파의 모든 차이는 격리가 정확히 무엇인지에 대한 의견 차이에서 시작된다. 

## 격리 문제에 대한 런던파의 접근
코드 조각을 격리된 방식으로 검증한다는 건 뭘 의미할까? 런던파에선 테스트 대상 시스템을 협력자에게서 격리하는 것을 일컫는다. 즉, 하나의 클래스가 다른 클래스 또는 여러 클래스에 의존하면 그 모든 의존성을 태스트 대역(test double)으로 대체해야 한다. 그럼으로써 동작을 외부 영향과 분리해 테스트 대상 클래스에만 집중할 수 있다. 

이 방법의 이점 중 하나는 테스트가 실패하면 코드베이스의 어느 부분이 고장났는지 확실히 알 수 있다는 점이다. 테스트 대역으로 대체했기 때문에 의심할 여지가 없다. 

또 다른 이점은 객체 그래프(같은 문제를 해결하는 클래스의 통신망)를 분할할 수 있다는 점이다. 모든 클래스가 각각 직접적인 의존성을 갖고 있으며 또 그 의존성이 또 다른 의존성을 갖고 있는 형태로, 그래프는 복잡해질 수 있다. 클래스는 심지어 순환 의존성을 갖고 있을 수도 있다. 의존성을 가진 코드베이스를 테스트하는 것은 테스트 대역 없이는 힘들다. 유일하게 남은 선택지는 전체 객체 그래프를 다시 만드는 것이다. 하지만 이 선택은 클래스 수가 너무 많으면 어려워질 수 있다. 

그에 반해 테스트 대역을 사용하면 객체 그래프를 다시 만들지 않아도 된다. 또 클래스의 직접적인 의존성을 대체할 수 있고, 다 나아가 의존성의 의존성을 다룰 필요도 없다. 그래프를 효과적으로 분해해 단위 테스트에 필요한 준비를 크게 줄일 수 있다.

그리고 단위 테스트 격리에는 작지만 좋은 부가적 이점이 있다. 프로젝트 전반적으로 한 번에 하나의 클래스만 테스트하라는 지침을 도입하면 전체 단위 테스트 스위트를 간단한 구조로 만들 수 있다. 더 이상 코드베이스를 테스트하는 방법을 고민할 필요가 없는 것이다. 

고전 스타일에선 테스트 대상 시스템과 협력자 모두 실제 운영 인스턴스를 사용하지만, 런던 스타일에선 이와 다르게 협력자는 목 객체로 대체한다. 즉, 런던 스타일의 테스트에선 협력자가 구현체를 사용하지 않고 인터페이스로 만든 목을 사용한다. 

## 격리 문제에 대한 고전파의 접근
다시 말해 런던 스타일은 테스트 대역으로 테스트 대상 코드 조각을 분리해서 격리 요구 사항에 다가간다. 이 관점은 무엇이 작은 코드 조각(단위)에 해당하는지에 대한 견해에도 영향을 미친다. 해당 관점에서 바라보면 단위 테스트의 세 가지 속성 중 첫 번째 속성도 다양한 해석이 가능하다. 단위는 얼마나 작아야 하는가? 각각의 모든 클래스를 격리해야 한다면 테스트 대상 코드 조각은 당연히 클래스이거나 메서드이어야 한다. 때에 따라 한 번에 여러 개의 클래스를 테스트할 수도 있긴 하다. 하지만 일반적으로 한 번에 하나의 클래스를 테스트하려고 노력해야 한다.

각각의 테스트를 격리하는 건 여러 클래스가 모두 메모리에 상주하고 공유 상태에 도달하지 않는 한, 여러 클래스를 한 번에 테스트해도 괜찮다는 뜻이다. 이를 통해 테스트가 서로 소통하고 실행 컨텍스트에 영향을 줄 수도 있다. 데이터베이스, 파일 시스템 등 프로세스 외부 의존성이 이런 공유 상태의 대표적인 예이다. 

## 단위 테스트의 런던파와 고전파
런던파와 고전파의 차이는 격리 특성에 있다. 런던파는 테스트 대상 시스템에서 협력자를 격리하는 것으로 보는 반면, 고전파는 단위 테스트끼리 격리하는 것으로 본다. 

### 고전파와 런던파가 의존성을 다루는 방법
테스트 대역을 어디에서나 흔히 사용할 순 있지만, 런던파는 테스트에서 일부 의존성을 그대로 사용할 수 있도록 하고 있다. 절대 변하지 않는 객체, 불변 객체는 교체하지 않아도 된다.

그런 불변 객체를 값 객체 또는 값이라고 한다. 이것의 특징은 정체성이 없다는 것이다. 즉, 내용에 의해서만 식별된다. 그래서 같은 내용을 갖고 있다면 어떤 객체를 사용하든 상관없다.

|     | 격리 주체  | 단위의 크기           | 테스트 대역 사용 대상    |
|-----|--------|------------------|-----------------|
| 런던파 | 단위     | 단일 클래스           | 불변 의존성 외 모든 의존성 |
| 고전파 | 단위 테스트 | 단일 클래스 또는 클래스 세트 | 공유 의존성          |

## 고전파와 런던파의 비교


