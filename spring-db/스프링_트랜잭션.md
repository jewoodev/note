# 스프링 트랜잭션

스프링 트랜잭션은 개발자가 별도로 설정하지 않으면 알아서 트랜잭션 프록시를 생성해서 이를 호출한다. 

이 프록시 객체는 스프링 컨테이너에서 트랜잭션 매니저를 가져와서 트랜잭션을 획득한다. 트랜잭션 매니저가 트랜잭션을 획득하는 과정에서는 트랜잭션 매니저가 데이터 소스를 통해 커넥션을 조회하고 auto commit을 false로 설정하고 커넥션을 트랜잭션 동기화 매니저에 보관한다.

이런 절차 후에 트랜잭션 프록시 객체가 실제 서비스를 호출해서 비즈니스 로직을 수행한다. 수행하는 와중에 데이터 접근할 때는 트랜잭션 동기화 매니저에 보관되어 있는 커넥션을 가져와서 데이터베이스에 접근한다.

스프링 트랜잭션을 사용할 때 `@Transactional`을 메서드나 클래스의 타입 선언문 위에 달아서 트랜잭션 적용 여부를 통제하게 된다. 이 때, 주의할 점이 있다.

## 트랜잭션 AOP 주의할 점

하나의 클래스에 두 메서드가 있다.

그런 클래스의 메서드 중 하나는 트랜잭션을 적용하지 않고 하나는 적용한 상황에서, 적용하지 않은 메서드 내부에서 적용한 메서드를 호출하면, 적용한 메서드조차 트랜잭션이 적용되지 않는다.

그렇게 되는 이유는 적용한 메서드가 호출될 때 `this.적용한메서드()`가 호출되는데 this는 프록시 객체를 지칭할 수 없기 때문이다. `@Transactional`를 사용하는 트랜잭션 AOP는 프록시를 사용하기 때문에 트랜잭션이 적용될 수 없게 되는 것이다.

# 트랜잭션 AOP 주의할 점 &rarr; 출처

- [김영한님의 스프링 DB 2편](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-db-2/dashboard)