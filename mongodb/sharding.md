MongoDB 샤딩은 대규모 데이터셋을 여러 서버에 분산하여 저장하는 수평적 확장 방식이다. 주요 특징과 구성요소를 살펴보자.

## 1. 샤딩의 기본 구성요소
- **mongos** (라우터)
    - 클라이언트의 쿼리를 적절한 샤드로 라우팅
    - 클라이언트와 샤드 클러스터 사이의 인터페이스 역할
    - 여러 개의 mongos를 구성하여 고가용성 확보 가능
- **Config Servers**
    - 클러스터의 메타데이터 저장
    - 클러스터의 메타데이터 저장
    - 샤드 키, 청크 분포, 클러스터 구성 정보 등 관리
    - 최소 3개의 config 서버로 구성 권장
- **Shard Servers**
    - 실제 데이터를 저장하는 서버들
    - 각 샤드는 독립적인 MongoDB 인스턴스
    - 복제 세트로 구성하여 고가용성 확보 가능
## 2. 샤딩 전략
- **Range-based Sharding**
    - 샤드 키의 값 범위를 기준으로 데이터 분할
    - 범위 기반 쿼리에 효율적
    - 데이터 불균형 발생 가능성 있음
- **Hash-based Sharding**
    - 샤드 키의 해시값을 기준으로 데이터 분할
    - 데이터 분포가 균일
    - 범위 기반 쿼리 성능 저하 가능성
## 3. 샤딩 키(Shard Key) 선택 시 고려사항
- **Cardinality(기수성)**
    - 높은 기수성을 가진 필드 선택
    - 데이터 분포의 균형을 위해 중요
- **Write Distribution**
    - 쓰기 작업이 특정 샤드에 집중되지 않도록 고려
    - 단조 증가하는 값은 피하는 것이 좋음
- **Query Patterns**
    - 자주 사용되는 쿼리 패턴 고려
    - 샤드 키를 포함한 쿼리가 효율적
## 4. 샤딩의 장점
- **수평적 확장성**
    - 데이터 증가에 따라 샤드 추가 가능
    - 시스템 용량을 유연하게 확장
- **성능 향상**
    - 쿼리 부하 분산
    - 병렬 처리 가능
- **고가용성**
    - 샤드 단위의 장애 격리
    - 복제 세트와 결합하여 안정성 확보
## 5. 샤딩 시 주의사항
- **샤드 키 변경의 제한**
    - 샤드 키는 한번 설정하면 변경이 어려움
    - 신중한 샤드 키 선택 필요
- **운영 복잡성**
    - 클러스터 관리의 복잡성 증가
    - 모니터링과 유지보수 필요
- **리소스 요구사항**
    - 추가적인 하드웨어 리소스 필요
    - 네트워크 대역폭 고려
## 6. 샤딩 구현 시 고려사항
- **청크 크기**
    - 기본 청크 크기는 64MB
    - 데이터 특성에 따라 조정 가능
- **밸런서**
    - 데이터 재분배를 담당
    - 청크 분포 모니터링 및 조정
- **백업 전략**
    - 분산 환경에 맞는 백업 전략 수립
    - 복구 계획 수립

이러한 샤딩 구성은 대규모 데이터를 처리하는 MongoDB 시스템에서 필수적인 요소이며, 시스템의 성능과 확장성을 크게 향상시킬 수 있다.

---

샤딩 키로는 어떤 특징을 갖는 값을 선택해야 할까?

- 불변성
    - 값에 변경이 일어날 시 데이터 재분배가 필요
    