# XSS
Cross-site Scripting 의 줄임말. 줄이면 CSS인데 Cascading Style Sheet와 혼동이 올 수 있어서 XSS라고 부르는 것이다.

SQL injection과 함께 웹 상에서 가장 기초적인 취약점 공격 방법의 일종으로, 악의적인 사용자가 공격하려는 사이트에 스크립트를 넣는 기법을 말한다. 공격에 성공하면 사이트에 접속한 사용자는 삽입된 코드를 실행하게 되며, 보통 의도치 않은 행동을 수행시키거나 쿠키나 세션 토큰 등의 민감한 정보를 탈취한다.

공격 방법에 따라 Stored XSS와 Reflected XSS로 나뉜다. Stored XSS는 사이트 게시판이나 댓글, 닉네임 등 스크립트가 서버에 저장되어 실행되는 방식이고, Reflected XSS는 보통 URL 파라미터(특히 GET 방식)에 스크립트를 넣어 서버에 저장하지 않고 그 즉시 스크립트를 만드는 방식이다. 후술된 내용 대부분은 Stored XSS라고 생각하면 된다. Reflected XSS의 경우 브라우저 자체에서 차단하는 경우가 많아 상대적으로 공격을 성공시키기 어렵다.

크로스 사이트 스크립팅이라는 이름 답게, 자바스크립트를 사용하여 공격하는 경우가 많다. 공격 방법이 단순하고 가장 기초적이지만, 많은 웹사이트들이 XSS에 대한 방어 조치를 해두지 않아 공격을 받는 경우가 많다. 여러 사용자가 접근 가능한 게시판 등에 코드를 삽입하는 경우도 많으며, 경우에 따라서는 메일과 같은 매체를 통해서도 전파된다. 심지어는 닉네임에 코드를 심기도 한다.

물론, HTML을 사용하는 것이기 때문에, Text-Only 게시판이나, BBCode를 이용하는 위키위키 등에서는 XSS가 발생할 일은 없다. 단, 나무위키의 경우 {{{#!html HTML}}} 을 이용해서 HTML 태그를 사용할 수 있으므로 취약점이 있을 수도 있다. 나무위키 초반에는 스크립트 태그와 이벤트 속성도 막지 않았으나 이는 모두 수정되었다.

주로 CSRF를 하기 위해서 사용되기 때문에 종종 CSRF와 혼동되는 경우가 있으나, XSS는 자바스크립트를 실행시키는 것이고, CSRF는 특정한 행동을 시키는 것이므로 다르다.

## 예시
해커의 홈페이지에 PHP 파일을 만들고,[3] 공격할 사이트에 스크립트를 심은 뒤,[4] 사용자가 스크립트가 심어진 페이지를 볼 경우, 쿠키값이 해커의 홈페이지로 넘어가서 세션 하이재킹이 가능해진다.

## 기법
아래는 한국에서 가장 많이 사용되는 IE(Internet Explorer) 기준으로 작성한 것이다. 따라서 크롬, 파이어폭스 등의 브라우저나 최신 브라우저 환경에서는 더 이상 작동하지 않는다. 실험은 [이곳](https://www.w3schools.com/html/tryit.asp?filename=tryhtml_basic)에서 해보자.

### 스크립트 태그

| 방법 | 스크립트 태그로 자바스크립트를 실행한다.                                                                                                                                                                                                                                                                                                               |
|----|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 예제 | `<script>alert('XSS');</script>`                                                                                                                                                                                                                                                                                                     |
| 설명 | 스크립트 태그의 스크립트를 실행시킨다. 안타깝게도, 매우 정직한 방법이라 대부분의 사이트에서 막는 경우가 많다. 브라우저단에서 필터링 해주는 경우도 있다. [~~물론 예외도 있다.~~](https://twitter.com/dergeruhn/status/476764918763749376) 하지만 만들어진 지 몇십 년 이상 되었거나, [보안 X까!](https://namu.wiki/w/%EC%95%88%EC%A0%84%EB%B6%88%EA%B0%90%EC%A6%9D) 하면서 막지도 않는 경우도 있다. ~~애초에 비밀번호를 평문/MD5로 저장하는 경우도 있는데 새삼스럽게...~~ |

### 자바스크립트 링크

| 방법 | 링크 태그로 자바스크립트를 실행한다.                                                                                                 |
|----|----------------------------------------------------------------------------------------------------------------------|
| 예제 | `<a href="javascript:alert('XSS')">XSS</a>`                                                                          |
| 설명 | 브라우저에서 `about:` 링크와 같이, `javascript:` 로 시작하는 링크는 스크립트를 실행시킨다. 스크립트 태그와 같이, `javascript:`를 필터링하는 경우가 많아 많은 사이트에서 막는다. |

### 이벤트 속성
| 방법 | 이벤트 속성을 사용한다.                                                                                                                                     |
|----|---------------------------------------------------------------------------------------------------------------------------------------------------|
| 예제 | `<img src="#" onerror="alert('XSS')">`                                                                                                            |
| 설명 | 이벤트 속성으로 스크립트를 실행할 수 있다. 주로 `on` 으로 시작하는 속성이 이벤트 속성이다. 자주 사용되는 이벤트 속성으로는 `onload` `onerror` `onclick` 등이 있다. 물론, 이 방법 역시 '자바스크립트 링크' 방법만큼 많이 막혔다. |

### 블랙리스트 우회

| 방법 | 알려지지 않은 태그와 속성들을 사용한다.                                                                                                                                                 |
|----|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 예제 | `<ruby oncopy="alert('XSS')">XSS</ruby>`                                                                                                                               |
| 설명 | 블랙 리스트 방식으로 막는 사이트에 사용할 수 있다. [이벤트 속성 목록](http://www.w3schools.com/jsref/dom_obj_event.asp)을 참고하자. 위의 방법들보다는 적게 막혔으나, 여전히 최근 웹사이트들에선 화이트리스트 방식 차단이 대부분이라, 막혔을 가능성이 높다. |

### 내용 난독화

| 방법 | 따옴표로 감싸는 문자열 사이에 공백 문자들을 넣고, [HTML 인코드](https://mothereff.in/html-entities)를 하여 [난독화](https://namu.wiki/w/%EB%82%9C%EB%8F%85%ED%99%94)한다.                                          |
|----|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 예제 | `<a href="&#x6A;&#x61;&#x76;&#x61;&#x73;&#xA;&#x63;&#x72;&#x69;&#x70;&#x74;&#xA;&#x3A;&#xA;&#x61;&#x6C;&#x65;&#x72;&#x74;&#xA;&#x28;&#x27;&#x58;&#x53;&#x53;&#x27;&#x29;">XSS</a>` |
| 설명 | 일부 브라우저에서 `javascript:` 링크 사이에 공백 문자가 들어갈 수 있고, HTML 인코드를 해도 디코드된 내용이 출력된다는 점을 이용한다. 여기에서는 '자바스크립트 링크' 방법과 사용하였지만, 당연히 다른 방법과 함께 사용할 수 있다.                                         |

### 스크립트 난독화

| 방법 | [aaaencode](http://utf-8.jp/public/aaencode.html)에서 자바스크립트 [난독화](https://namu.wiki/w/%EB%82%9C%EB%8F%85%ED%99%94).                       |
|----|------------------------------------------------------------------------------------------------------------------------------------------|
| 예제 |                                                                                                                                          |
| 설명 | 스크립트를 일본어를 사용한 이모티콘들로 [난독화](https://namu.wiki/w/%EB%82%9C%EB%8F%85%ED%99%94)한다. 스크립트 실행은 가능하지만, `document.cookie`와 같은 단어를 막을 경우 사용하면 된다. |

## 방어 방법
XSS는 데이터를 입력할 때와 출력할 때, 모두 필터링하고, 클라이언트에도 막을 수 있을만한 수단을 구성해놓는 것이 좋다. 보안은 한없이 덧대도 끝이 없고, 아래 서술한 방식으로 구성해도 기어코 뚫어버리는 사람들이 존재하기 때문이다.

이후의 내용은 [XSS - 나무위키](https://namu.wiki/w/XSS#s-4)에서 확인하자.

# Reference
- [XSS - 나무위키](https://namu.wiki/w/XSS)