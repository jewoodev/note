# MVC 패턴

어떤 패턴의 도입없이 순수하게 서블릿과 JSP만으로 비즈니스 로직과 뷰 렌더링까지 모두 처리하게 되면, 서블릿과 JSP가 너무 많은 역할을 갖게되어 유지보수가 어려워진다.

비즈니스 로직에 변경이 발생해도 서블릿과 JSP 모두를 수정해야 하고, UI만 변경하려고 해도 서블릿과 JSP 모두를 수정해야 한다. 게다가 역할이 많은 만큼 수정할 코드의 위치도 찾기 어려울 것이다.

HTML 코드 하나 수정해야 하는데 수백 줄의 자바 코드가 함께 있다고 상상해보라! 또는 비즈니스 로직 코드를 수정해야 하는데 수백 수천 줄의 HTML 코드가 함꼐 있다고 상상해보라!

그리고 진짜 중요한 문제는 둘이 갖는 변경의 라이프 사이클도 다르다는 점이다. UI에 대한 수정이 필요한 일이 생겨나는 것과 비즈니스 로직을 수정해야 하는 일은 각기 다르게 일어날테니 이를 분리해야 매 수정마다 골머리를 쌓지 않을 것이다.

## Model, View, Controller 로 나누기

MVC 패턴은 비즈니스 로직과 뷰 렌더링을 처리하는 역할을 컨트롤러와 뷰라는 이름으로 나눈 것을 말한다.웹 애플리케이션은 보통 이 MVC 패턴을 사용한다.

**컨트롤러**: HTTP 요청을 받아서 파라미터를 검증하고, 비즈니스 로직을 호출한다. 그리고 뷰에 전달할 결과 데이터를 조회해서 모델에 담는다.

**모델**: 뷰에 출력할 데이터를 담아둔다. 뷰가 필요한 데이터를 모두 모델에 담아서 전달해줘서 뷰는 데이터 로직과 비즈니스 로직은 모른채 화면을 렌더링 하는 것에만 집중할 수 있다. 

**뷰**: 모델에 담겨있는 데이터를 사용해서 화면에 그리는 역할에 집중한다. (HTML 생성)

> 컨트롤러의 역할은 요청을 처리해서 응답을 생성하는 일련의 과정을 지휘하는 것에 있다. "비즈니스 로직"을 호출할 뿐 이것에 대한 책임까지 컨트롤러에 있진 않다. 비즈니스 로직 실행에 대한 책임은 "서비스"라는 추가적인 개념에게 할당한다.  

## MVC 컨트롤러의 한계

MVC 패턴을 적용하고 나면 컨트롤러의 역할과 뷰를 렌더링 하는 역할을 명확하게 구분지어 분리할 수 있다. 

하지만 컨트롤러의 코드 부분들에는 중복이 많고, 사용하지 않는 파라미터를 계속해서 전달하는 불필요한 코드가 남아있다.

증복을 없앨 수 없는 부분은 요청을 뷰로 포워딩해서 해당 자원이 클라이언트에게 응답을 생성하도록 하는 부분이다.

```java
RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
dispatcher.forward(request, response);
```

그리고 뷰 기술을 변경하게 되면 viewPath를 지정하는 코드에 변경점이 생긴다는 문제도 있다. 

`String viewPath = "/WEB-INF/views/index.jsp;` 뷰 파일마다 지정하는 이 코드에서 jsp가 아닌 기술을 사용하게 되면 `/WEB-INF/views/` 와 `.jsp` 부분을 선언된 모든 viewPath에서 수정해야 한다.

그리고 컨트롤러 로직에서 `request`와 `response`를 사용하지 않는데 계속해서 가져와야 한다.  

이런 부분들을 스프링은 프론트 컨트롤러 패턴을 도입해 해결한다.

## 프론트 컨트롤러 패턴

MVC 컨트롤러의 한계점은 각 컨트롤러마다 같은 코드가 중복된다는 것이다. 중복되는 코드들은 공통적으로 모두 필요로 하는 코드들이다. 

공통되는 이 부분들을 컨트롤러 앞에서 처리하고 중복되지 않는 부분들을 컨트롤러에 두면 되지 않을까?

![img.png](https://github.com/jewoodev/blog_img/blob/main/spring-mvc/%ED%94%84%EB%A1%A0%ED%8A%B8_%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC%EC%9D%98_%EC%97%AD%ED%95%A0.png?raw=true)

이러한 상황에 적합한 디자인 패턴으로 "프론트 컨트롤러 패턴"이 있다.

이 패턴은 웹 애플리케이션 개발에서 사용되는 디자인 패턴으로 클라이언트의 모든 요청을 단일 진입점에서 처리하도록 설계하는 방법이다. 이 방법으로 요청 처리 로직을 중앙화해서 코드의 중복을 줄이고, 유지보수성을 높이면서 애플리케이션 구조를 일관성있게 만들 수 있다.

### 주요 개념과 특징

1. **단일 진입점** : 프론트 컨트롤러는 모든 클라이언트 요청을 단일 객체(Controller)가 먼저 받아들이는 구조를 의미한다. 이를 통해 필터링하거나 공통 작업(예: 인증, 로깅, 보안 검사 등)을 수행한 후, 해당 요청을 적절한 핸들러로 전달한다.
2. **중앙 집중화** : 요청 처리 로직이 중앙에 집중되므로 애플리케이션의 흐름 제어를 단순화 할 수 있다. 예를 들어, URL 매핑, 인증/인가, 로깅 등의 공통 기능을 하나의 컨트롤러에서 관리할 수 있다.
3. **유연성** : 요청을 처리할 컨트롤러를 동적으로 결정하거나, 다양한 요청 유형에 따라 다른 뷰또는 비즈니스 로직을 호출할 수 있는 구조를 제공한다.

### 구조

프론트 컨트롤러 패턴은 다음과 같은 구성 요소로 이루어져 있다.

1. **Front Controller** : 모든 요청을 받아들이고 공통 작업을 처리한 뒤 적절한 핸들러(서브 컨트롤러)로 요청을 위임한다.
2. **Dispatcher** : 요청을 처리할 적절한 핸들러 또는 뷰로 요청을 전달하는 역할을 한다.
3. **Handler/Controller** : 각 요청을 구체적으로 처리하는 컨트롤러로, 비즈니스 로직을 실행하거나 데이터를 처리한 후 뷰를 반환한다.
4. **View** : 클라이언트에게 응답 결과를 표시하는 역할을 한다.

이러한 설계를 통해 스프링은 웹 애플리케이션 로직을 확장성있고 변경으로 인한 파급효과의 반경이 최소가 되도록 만든다. 

그리고 스프링의 프론트 컨트롤러가 DispatcherServlet이다. 