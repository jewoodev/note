# 웹 애플리케이션 이해하기

웹은 "HTTP(HyperText Transfer Protocol)" 프로토콜을 기반으로 통신한다.

그리고 서버의 자원을 효율적으로 관리하기 위해 두 종류의 웹 서버를 사용한다. 그 두가지는 정적 리소스를 제공하는 역할을 웹 서버, 비즈니스 로직을 수행하는 역할을 웹 애플리케이션 서버이다.

> *참고!*  
> 웹 애플리케이션 서버는 웹 서버의 역할도 수행할 수 있다.

대중적으로 사용되는 웹 서버는 NGINX, APACHE 등이 있다. 웹 애플리케이션 서버는 Tomcat, Jetty 등이 있다. 각 기술마다 어떤 용도로 사용하려고 개발했는지, 프로그램의 탄생 역사가 다르기 때문에 완전히 다른 용도로 쓰이기도 한다. Tomcat은 동기 방식으로 통신하는데에 적합하고, Netty는 비동기 방식으로 통신하는데 적합하다.

## 웹 애플리케이션 서버를 구현하려면..

웹 통신이 이루어지기 위해 필요한 전제는 클라이언트 측이 HTTP 요청을 전송하고 서버가 요청대로의 작업을 수행한 후 응답을 되돌려줄 수 있어야 한다는 것이다. 

이 전제를 "클라이언트 측이 HTTP 요청을 전송한다." 와 "서버가 클라이언트의 요청대로 작업을 수행한 후 응답을 되돌려줄 수 있다."로 분리하고 후자를 살펴보자. 이게 웹 애플리케이션 서버가 하는 일의 전부이다.

그 일을 위해서는 다양한 기능이 구현되어야 한다. 어떤 요청이냐에 따라서 달라지는데 데이터 저장 요청을 처리하기 위해서는 다음의 기능들이 필요하다.

- 서버 TCP/IP 연결 대기, 소켓 연결
- HTTP 요청 메세지를 파싱해서 읽기
- HTTP 메서드를 파악하고, URL 읽기
- Content-Type 확인
- HTTP 메세지 바디 내용 파싱
  - JSON으로 전달되거나 쿼리 파라미터로 전달되는 데이터를 사용할 수 있게 파싱하는 것을 말함
- 저장 프로세스 실행
- 비즈니스 로직 실행
  - 데이터베이스에 저장 요청
- HTTP 응답 메세지 생성 시작
  - HTTP 시작 라인 생성
  - Header 생성
  - 메세지 바디에 HTML 생성해서 입력
- TCP/IP에 응답 전달, 소켓 종료

굉장히 다양한 기능들이다. 그리고 실제로 구현해보면 매우 방대한 작업이 된다. 우리가 현재 사용하고 있는 WAS 기술들도 이런 기능들이 구현되어 있다.

이 기능들에서 `비즈니스 로직 실행, 데이터베이스에 저장 요청` 부분은 요구사항에 따라서 다양하게 변경되어야 하지만, 나머지 부분은 그렇지 않다. 동일한 목적을 갖는 기능들을 구현하기 위해 반복적인 코드 작업이 된다.

과거의 개발자들도 같은 생각을 했고 이걸 "서블릿"이라 이름붙여 개념화하고 반복적으로 사용할 수 있도록 만들었다. 다시말해, 웹 통신이 이루어지기 위한 웹 애플리케이션 서버 기능들 중 `비즈니스 로직 실행, 데이터베이스에 저장 요청` 부분 외에 기능들을 지원하는 기술이 "서블릿" 이다.

그래서 서블릿을 지원하는 WAS를 사용하면 `비즈니스 로직 실행, 데이터베이스에 저장 요청` 만 구현하면 된다. 

서블릿이 이런 정체성을 갖고 있는 만큼 이 기술을 이용하면 HTTP 스펙을 매우 편리하게 사용할 수 있다. 스프링을 통해 서블릿 기술을 사용하면 HTTP 요청 메세지를 파싱하고, HTTP 응답 메세지를 생성하기 위한 기능들은 서블릿 기술에 맡기고 `HttpServletRequest`나 `HttpServletResponse` 객체를 이용해 요구사항에 맞게 로직만 구성하면 된다.

### 서블릿의 생명주기를 관리하는 서블릿 컨테이너 

Tomcat처럼 서블릿을 지원하는 웹 애플리케이션 서버를 "서블릿 컨테이너"라고 한다.

그리고 서블릿의 생명 주기는 서블릿 컨테이너를 이용해서 관리한다. 예를 들어, WAS(웹 애플리케이션, 앞으로 WAS라 줄여 부르겠다.)가 실행될 때 컨테이너를 생성하고 컨테이너가 서블릿들을 모두  생성한 후 WAS가 종료될 때 서블릿들을 모두 종료한다. 

### 서블릿 컨테이너의 동시 요청 처리 지원, 주의할 점 

서블릿 컨테이너는 동시 요청을 처리하기 위해 **멀티 쓰레드** 처리를 지원한다. 여기서 주의해야 하는 점은, 서블릿 객체를 싱글튼으로 관리하기 때문에 공유 변수를 통해 개인 정보가 유실될 수 있다는 점이다.