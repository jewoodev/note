# 웹 서버와 스프링 부트

## 1. 자바 웹 서버 개발의 변천사

여느 웹 서버가 그렇듯 자바 웹 서버도 톰캣같은 WAS가 request를 받아 HTML, CSS 같은 정적 리소스를 response 하거나 필요에 의해 비즈니스 로직을 수행하여 반환한다. 

자바는 톰캣에 서버 소스를 war 확장자로 빌드하여 넣음으로써 외장 서버로 톰캣을 운영하는 방식을 사용했었다. 이러한 방식은 톰캣에 문제가 생기면 톰캣 버전을 바꿔줘야 하는데 이로인해 설정하는데 비용이 많이 들게 되는 것과 더불어 톰캣을 포함한 웹 서버를 구성하는데 사용하는 라이브러리들 간의 버전 충돌이 발생될 수 있어 개발 환경 세팅에 많은 비용이 드는 문제를 야기했다. 

오랫동안 많은 개발자들의 고민거리였던 이 문제를 해결하기 위해 스프링 부트 프로젝트가 시작되었다. 스프링 부트는 특정 도구에 필요한 라이브러리들이 어떤 버전들끼리 충돌이 나지 않고 가장 알맞게 세팅되는지 먼저 세팅을 해둠으로써 우리가 웹 개발에 필요한 라이브러리들을 선택하면 알아서 알맞게 의존성을 맞춰준다.

까다로웠던 톰캣 관리도 스프링 부트가 톰캣을 프레임워크의 내장 서버로 작동할 수 있게 세팅을 함으로써 개발자가 톰캣에 대한 세팅은 전혀 신경쓰지 않아도 되게 되버렸다. 

## 2. 톰캣을 내장하기 위한 FatJar

Jar 파일은 스펙 상으로 같은 Jar 파일을 포함할 수 없기 때문에 War 파일로 만들어 사용했던 한계점을 FarJar를 사용하는 것으로 돌파했다. FatJar는 하나의 라이브러리에 필요한 Jar 파일들을 압축을 풀어서 그 안의 class 파일들(+ 다른 파일)을 묶어서 Jar 파일로 만든 것을 말한다. 그렇다보니 보다 많은 파일들을 포함하게 되어 용량이 커지게 되었고 평범한 Jar 파일보다 뚱뚱하다는 의미에서 FatJar라는 명칭을 갖게되었다.

FatJar를 사용해 톰캣 라이브러리를 jar로 내장할 수 있게 되었다. 이로써 아래와 같은 단점들을 상쇄할 수 있게 되었다.

1. 톰캣 같은 WAS를 별도로 설치해야하는 번거로움
2. 개발 설정의 복잡성
   - 웹 애플리케이션은 WAS를 연동하기 위해 복잡한 설정이 필요
   - 외부에서 WAS를 실행시켜 웹 애플리케이션과 연동하지 않고 WAS 소스를 내장함으로써 `main()` 메서드를 실행함으로써 톰캣 컨트롤을 웹 애플리케이션 로직 안에서 해결 
3. 배포 과정의 복잡성
4. 톰캣 버전을 변경해야 할 때 해야하는 재설치로 인한 비용

위와 같이 War의 단점들을 커버하지만 Fat Jar로 단점을 갖고 있다.

1. 어떤 라이브러리가 포함되어 있는지 파악하기 어려움
2. 파일명 중복 문제를 해결할 수 없음

그리고 Fat Jar가 갖는 이슈마저 Spring은 해결했다.

## 3. 스프링이 개선한 Jar

스프링은 자바 표준 Jar 스펙에서 오는 한계를 돌파하기 위해 새로운 Jar를 정의했다. 일명 '실행 가능 Jar'이다.  
이를 통해 2번의 Fat Jar의 단점도 상쇄한다.

## 3.1 Jar파일의 규격

- `META-INF`폴더에 있는 `MANIFEST.MF`에서 메인메서드가 어디있는지 찾아서 실행한다.